<html>
  <head>
    <meta charset="utf-8" />
    <title>AR.js + A-Frame - Escena Básica</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #loading {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 20px;
        border-radius: 10px;
        z-index: 1000;
        text-align: center;
      }
      #error {
        position: fixed;
        top: 10px;
        left: 10px;
        right: 10px;
        background: rgba(255,0,0,0.8);
        color: white;
        padding: 10px;
        border-radius: 5px;
        z-index: 1000;
        display: none;
      }
    </style>
  </head>

  <body>
    <div id="loading">Cargando experiencia AR...</div>
    <div id="error"></div>
    <div id="status" style="position: fixed; bottom: 10px; left: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; z-index: 1000; text-align: center; display: none;">Apunta la cámara al marcador</div>
    
    <!-- La escena AR -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: true; detectionMode: mono_and_matrix; matrixCodeType: 3x3; markersAreaEnabled: true;">
      
      <!-- Luz ambiental y direccional -->
      <a-entity light="type: ambient; intensity: 0.8"></a-entity>
      <a-entity light="type: directional; intensity: 0.6" position="1 1 0"></a-entity>

      <!-- Marcador 1 (por ejemplo, recepcion.patt) -->
      <a-marker type="pattern" url="markers/recepcion.patt" id="marker-recepcion">
        <a-box position="0 0.5 0" material="color: gold;"></a-box>
        <a-text value="RECEPCIÓN" position="0 1.5 0" align="center" color="white" scale="2 2 2"></a-text>
      </a-marker>

      <!-- Marcador 2 (aula magna) -->
      <a-marker type="pattern" url="markers/aula_magna.patt">
        <a-sphere position="0 0.5 0" radius="0.5" material="color: crimson;"></a-sphere>
      </a-marker>

      <!-- Marcador 3 (patio) -->
      <a-marker type="pattern" url="markers/patio.patt">
        <a-cone position="0 0.5 0" height="1" radius-bottom="0.5" material="color: green;"></a-cone>
      </a-marker>

      <!-- Marcador 4 (cantina) -->
      <a-marker type="pattern" url="markers/cantina.patt">
        <a-cylinder position="0 0.5 0" radius="0.3" height="1" material="color: royalblue;"></a-cylinder>
      </a-marker>

      <!-- Marcador 5 (meta del mapa) -->
      <a-marker type="pattern" url="markers/meta.patt">
        <a-box position="0 0.5 0" material="color: gold; metalness: 0.8; roughness: 0.2;"></a-box>
        <a-text value="TESORO" position="0 1.5 0" align="center" color="gold" scale="2 2 2"></a-text>
      </a-marker>

      <!-- Cámara AR -->
      <a-entity camera></a-entity>

    </a-scene>

    <script>
      // Manejo de errores y carga
      window.addEventListener('load', function() {
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        
        // Ocultar loading después de 3 segundos
        setTimeout(() => {
          loading.style.display = 'none';
        }, 3000);
        
        // Manejo de errores de A-Frame
        document.querySelector('a-scene').addEventListener('loaded', function() {
          console.log('Escena AR cargada correctamente');
          loading.style.display = 'none';
          document.getElementById('status').style.display = 'block';
        });
        
        // Manejo de errores de cámara
        document.querySelector('a-scene').addEventListener('camera-error', function() {
          error.style.display = 'block';
          error.textContent = 'Error: No se pudo acceder a la cámara. Asegúrate de permitir el acceso.';
          loading.style.display = 'none';
        });
        
        // Manejo de errores generales
        window.addEventListener('error', function(e) {
          console.error('Error:', e.error);
          error.style.display = 'block';
          error.textContent = 'Error: ' + e.message;
          loading.style.display = 'none';
        });
        
        // Detectar marcadores
        document.querySelectorAll('a-marker').forEach(function(marker) {
          marker.addEventListener('markerFound', function() {
            console.log('¡Marcador detectado!', marker.id);
            document.getElementById('status').textContent = '¡Marcador detectado!';
            document.getElementById('status').style.background = 'rgba(0,255,0,0.8)';
          });
          
          marker.addEventListener('markerLost', function() {
            console.log('Marcador perdido', marker.id);
            document.getElementById('status').textContent = 'Apunta la cámara al marcador';
            document.getElementById('status').style.background = 'rgba(0,0,0,0.8)';
          });
        });
      });
    </script>
  </body>
</html>