<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Test Tesoro GLTF</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #status {
            position: fixed;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
            text-align: center;
        }
        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 1000;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="loading">Cargando modelo del tesoro...</div>
    <div id="status">Apunta la cámara al marcador meta.patt</div>
    
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: true; markersAreaEnabled: true;">
        
        <!-- Luz -->
        <a-entity light="type: ambient; intensity: 0.8"></a-entity>
        <a-entity light="type: directional; intensity: 0.6" position="1 1 0"></a-entity>

        <!-- Marcador del tesoro con modelo GLTF -->
        <a-marker type="pattern" url="markers/meta.patt" id="treasure-marker">
            <a-entity
                gltf-model="url(modelos/tesoro.glb)"
                scale="0.3 0.3 0.3"
                rotation="0 180 0"
                position="0 0 0"
                id="treasure-model">
            </a-entity>
            <a-text value="¡TESORO!" position="0 2 0" align="center" color="gold" scale="2 2 2"></a-text>
        </a-marker>

        <!-- Cámara -->
        <a-entity camera></a-entity>

    </a-scene>

    <script>
        const status = document.getElementById('status');
        const loading = document.getElementById('loading');
        
        // Detectar marcador
        document.querySelector('#treasure-marker').addEventListener('markerFound', function() {
            console.log('¡Marcador del tesoro detectado!');
            status.textContent = '¡TESORO ENCONTRADO! ¡FELICITACIONES!';
            status.style.background = 'rgba(255,215,0,0.8)';
        });
        
        document.querySelector('#treasure-marker').addEventListener('markerLost', function() {
            console.log('Marcador del tesoro perdido');
            status.textContent = 'Apunta la cámara al marcador meta.patt';
            status.style.background = 'rgba(0,0,0,0.8)';
        });
        
        // Manejo del modelo GLTF
        const treasureModel = document.querySelector('#treasure-model');
        if (treasureModel) {
            treasureModel.addEventListener('model-loaded', function() {
                console.log('✅ Modelo del tesoro cargado correctamente');
                loading.style.display = 'none';
                status.textContent = 'Modelo cargado. Apunta la cámara al marcador meta.patt';
            });
            
            treasureModel.addEventListener('model-error', function() {
                console.error('❌ Error cargando modelo del tesoro');
                loading.style.display = 'none';
                status.textContent = 'Error: No se pudo cargar el modelo del tesoro';
                status.style.background = 'rgba(255,0,0,0.8)';
            });
        }
        
        // Timeout de seguridad
        setTimeout(() => {
            loading.style.display = 'none';
        }, 10000);
        
        // Verificar que el archivo de modelo existe
        fetch('modelos/tesoro.glb')
            .then(response => {
                if (response.ok) {
                    console.log('✅ Archivo del modelo accesible');
                } else {
                    console.error('❌ Archivo del modelo no accesible');
                    status.textContent = 'Error: No se puede cargar el archivo del modelo';
                    status.style.background = 'rgba(255,0,0,0.8)';
                    loading.style.display = 'none';
                }
            })
            .catch(error => {
                console.error('❌ Error cargando modelo:', error);
                status.textContent = 'Error: ' + error.message;
                status.style.background = 'rgba(255,0,0,0.8)';
                loading.style.display = 'none';
            });
    </script>
</body>
</html>
